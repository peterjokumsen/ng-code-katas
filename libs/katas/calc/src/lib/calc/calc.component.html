<ng-template
  #numberInputTemplate
  let-control="control"
  let-controlLabel="controlLabel"
>
  <div class="form-floating mb-3">
    <input
      #numberInput
      type="number"
      id="{{ control.name }}"
      class="form-control"
      [ngClass]="{ 'is-invalid': !control.untouched && !control.valid }"
      [formControl]="control"
    />
    <label for="{{ control.name }}">{{ controlLabel }}</label>

    <ng-container *ngIf="control?.errors; let errors">
      <p class="text-danger" *ngIf="errors['required'] && !control.untouched">
        Please supply a value.
      </p>
    </ng-container>
  </div>
</ng-template>

<div class="container">
  <h1>Calculator</h1>
  <div class="row calculator">
    <div class="col-12 col-md-6 inputs">
      <form [formGroup]="calcFormGroup">
        <ng-container
          [ngTemplateOutlet]="numberInputTemplate"
          [ngTemplateOutletContext]="{
            control: calcFormGroup.get('firstNumber'),
            controlLabel: 'First Number'
          }"
        ></ng-container>

        <div class="form-floating mb-3">
          <select id="operator" formControlName="operator" class="form-select">
            <option *ngFor="let operator of operators" [value]="operator.key">
              {{ operator.label }}
            </option>
          </select>
          <label for="operator">Operator</label>
        </div>

        <ng-container
          [ngTemplateOutlet]="numberInputTemplate"
          [ngTemplateOutletContext]="{
            control: calcFormGroup.get('secondNumber'),
            controlLabel: 'Second Number'
          }"
        ></ng-container>
      </form>
    </div>
    <div class="col-12 col-md-6 output">
      <div
        class="results"
        *ngIf="result$ | async; let result; else: provideValuesTemplate"
      >
        <h2>Result</h2>
        <p>{{ result ?? '0' }}</p>
      </div>
      <ng-template #provideValuesTemplate>
        <h2>Awaiting values</h2>
        <p>Please provide a value to start.</p>
      </ng-template>
    </div>
  </div>
</div>
