<div class="container">
  <h1>Task list</h1>

  <div class="badge bg-secondary mb-3">Last action: {{ svc.lastAction() }}</div>

  <ng-template #inputError let-control="control" let-label="label">
    @if (control.errors && control.touched) {
      <p class="error" *ngIf="control.errors.required">
        {{ label }} is required
      </p>
    }
  </ng-template>

  <form [formGroup]="taskForm">
    <div class="form-floating mb-3">
      <input
        type="text"
        class="form-control"
        id="title"
        formControlName="title"
      />
      <label for="title">Title</label>
      <ng-container
        [ngTemplateOutlet]="inputError"
        [ngTemplateOutletContext]="{
          control: taskForm.get('title'),
          label: 'Title'
        }"
      ></ng-container>
    </div>

    <div class="form-floating mb-3">
      <textarea
        type="text"
        class="form-control"
        id="description"
        formControlName="description"
      ></textarea>
      <label for="description">Description</label>
      <ng-container
        [ngTemplateOutlet]="inputError"
        [ngTemplateOutletContext]="{
          control: taskForm.get('description'),
          label: 'Description'
        }"
      ></ng-container>
    </div>

    <button (click)="addTask()" [disabled]="!taskForm.valid">Add task</button>
  </form>

  <div class="task-list mt-3">
    @if (svc.tasks().length === 0) {
      <div class="badge bg-success">No tasks</div>
    } @else {
      @for (task of svc.tasks(); track task.id) {
        <app-task
          [task]="task"
          (removeTask)="svc.removeTask($event)"
          (saveTask)="svc.updateTask($event.id, $event)"
        ></app-task>
      }
    }
  </div>
</div>
